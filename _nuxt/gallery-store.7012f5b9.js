import{V as e,r as t,ax as l,E as a,av as n,aw as r,a9 as s}from"./entry.40e762a9.js";import{u as o}from"./wallet-store.d6533bc0.js";import"./index.77e4f8bb.js";const u=(e,t,l)=>{const a=e.length;let n=0;let r;const s=o=>{(()=>{let r=!1;for(let s=0;s<t&&!r;s++)n>=a?r=!0:l(e[n],n),n++;return r})()?o():r=setTimeout((()=>{s(o)}),5)};return{cancel:()=>{clearTimeout(r)},start:()=>new Promise((e=>s(e)))}},i=e=>"token"===e.type?h("Serial",e.token<=-1?"Not Found":e.token.toString()):"trait"===e.type?h(e.trait.name,e.value.name):"",c=(e,t)=>(e%t+t)%t,v=(e,t)=>c(e+t,1e4),h=(e,t)=>(e+":"+t).toLowerCase(),d=(e,a,n,r)=>{e.tokens.sort(((e,t)=>t[0]-e[0]));const s={},o=l([]),d=l([]),f=l(null),m=l(!1),p=t(!1),g=t=>{const[l,s]=t,o=s.map((([t,l])=>{const a=e.traits[t],n=a.values[l];return{name:a.name,value:n.name}})),u=((e,t)=>c(e-t,1e4))(l,r),v=`https://opensea.io/assets/ethereum/${n}/${u}`,d=t[2],f=`${a}/thumbs/${d}.png`,m=`${a}/images/${d}.png`;return{id:l,idShifted:u,validFilters:[...o.map((e=>h(e.name,e.value))),i({token:l,type:"token"})],image:{overlay:m,thumb:f},openSeaUrl:v,source:t,traits:o}},k=new Map,y=e=>{const[t]=e;if(k.has(t))return k.get(t);{let l=g(e);return k.set(t,l),l}};let S=null;const T=async()=>{let t=[];if(o.value.length>0)if(1===o.value.length&&"token"===o.value[0].type){const e=o.value[0].token,l=v(e,r),a=F(l);a&&t.push(a)}else{p.value=!0;const l=[...o.value.reduce(((e,t)=>{let l=e.get(t.trait);return l||(l=[],e.set(t.trait,l)),l.push(t),e}),new Map).values()];t=[],null!==S&&S.cancel(),S=u(e.tokens,400,(e=>{const a=y(e);let n=l.map((()=>!1));l.forEach(((e,t)=>{for(let l=0;l<e.length&&!n[t];l++){a.validFilters.indexOf(e[l].filterId)>=0&&(n[t]=!0)}}));n.reduce(((e,t)=>e&&t),!0)&&t.push(a)})),await S.start()}else t=e.tokens.map(y);m.value?(e=>{let t,l=e.length;for(;0!=l;)t=Math.floor(Math.random()*l),l--,[e[l],e[t]]=[e[t],e[l]]})(t):t.sort(((e,t)=>e.idShifted-t.idShifted)),S=null,p.value=!1,d.value=t};T();const N=(e=!0)=>{m.value=!1,e&&T()},w=(e=!0)=>{Object.keys(s).forEach((e=>delete s[e])),o.value=[],N(!1),e&&T()},F=t=>{const l=e.tokens.filter((e=>e[0]===t));return l.length>0?g(l[0]):null};return{results:d,appliedFilters:o,selectedItem:f,searchById:t=>{const l=e.tokens.filter((e=>e[0]===t));l.length>0?d.value=[y(l[0])]:d.value=[]},loading:p,applyFilter(e){const{trait:t,type:l="trait",token:a=NaN,value:n}=e;("trait"!==l||t||n)&&"token"===l&&isNaN(a),("token"===l||o.value&&o.value.length>0&&"token"===o.value[0].type)&&w(!1);const r=i(e);e.filterId=r,s[r]||(s[r]=e,o.value=[...o.value,e],N(!1),T())},hasFilter(e){const t=i(e);return void 0!==s[t]},clearFilter(e){const t=i(e);s[t]&&(delete s[t],o.value=o.value.filter((e=>{const l=i(e);return t!==l})),N(!1),T())},removeAllFilters:w,getTokenDetail:F,setSelectedItem(e){f.value=e},shuffle(){m.value=!0,T()},hasShuffle:m,clearShuffle:N}},f=n("gallery-store",(()=>{const n=l(!1),u=l(!1),i=l([]),c=t(),v=l(),{GALLERY_URL:h,CONTRACT_ADDRESS:f,CONTRACT_TOKEN_ID_SHIFT:m,API_URL:p}=r().public,g=s();return n.value||"/render-asset"!==g.path&&(async e=>fetch(`${e}/gallery.json`).then((e=>e.json())))(h).then((e=>(i.value=e.traits,d(e,h,f,parseInt(m))))).then((r=>{c.value=r,v.value=((n,r)=>{const s=o(),u=e(),i=t(!1),c=l([]),v=e=>{var t;const l=null==(t=e.tokenUri)?void 0:t.raw.match(/(\d*)(?=\.json$)/gm);if(null!=l){const e=parseInt(l[0]);return n.getTokenDetail(e)}return null},h=()=>{if(s.connected){i.value=!0,c.value=[];const e=s.accounts[0];return fetch(`${r}/my-collection/${e}`,{method:"GET"}).then((e=>e.json())).then((e=>{i.value=!1,(null==e?void 0:e.success)?c.value=e.ownedNfts.ownedNfts.map(v).filter((e=>null!==e)):c.value=[]}))}c.value=[]};return a((()=>[u.galleryCategory,s.connected]),(([e,t])=>{"my"===e&&t?h():c.value.length>0&&(c.value=[],i.value=!1)})),{results:c,getWalletNFTs:h,loading:i}})(r,p),n.value=!0})).catch((e=>{u.value=!0})),{error:u,initialised:n,traits:i,search:c,collection:v}}));export{v as i,f as u};
