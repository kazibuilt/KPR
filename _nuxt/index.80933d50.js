var t=Object.defineProperty,e=(e,i,s)=>(((e,i,s)=>{i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[i]=s})(e,"symbol"!=typeof i?i+"":i,s),s);import{c as i}from"./create-canvas.f1f3dfa0.js";import{C as s}from"./index.6c8f1534.js";import{x as a}from"./entry.40e762a9.js";import{r as n}from"./resize-observer.8438de8e.js";import{s as h}from"./store.4d67c1b5.js";import{l as o}from"./lerp.a6fc2763.js";function c(t,e,i,s=!0,a){let n=window.devicePixelRatio?window.devicePixelRatio:1;n=Math.max(n,1),t.canvas.width=e,t.canvas.height=i,t.canvas.style.width=`${e}px`,t.canvas.style.height=`${i}px`,s&&(a&&(n=Math.min(n,a)),t.canvas.width=e*n,t.canvas.height=i*n,t.scale(n,n))}function r(t,e,i){var s,a,n,h,o,c,r,l,y,p,v,d,x,g,u,f,m,w,M=function(t,e,i){i.x=e.x-t.x,i.y=e.y-t.y,i.len=Math.sqrt(i.x*i.x+i.y*i.y),i.nx=i.x/i.len,i.ny=i.y/i.len,i.ang=Math.atan2(i.ny,i.nx)};for(w=i,l={},y={},o=e[(h=e.length)-1],s=0;s<h;s++)c=e[s%h],r=e[(s+1)%h],M(c,o,l),M(c,r,y),p=l.nx*y.ny-l.ny*y.nx,v=l.nx*y.nx-l.ny*-y.ny,g=Math.asin(p<-1?-1:p>1?1:p),d=1,x=!1,v<0?g<0?g=Math.PI+g:(g=Math.PI-g,d=-1,x=!0):g>0&&(d=-1,x=!0),w=void 0!==c.radius?c.radius:i,u=g/2,(m=Math.abs(Math.cos(u)*w/Math.sin(u)))>Math.min(l.len/2,y.len/2)?(m=Math.min(l.len/2,y.len/2),f=Math.abs(m*Math.sin(u)/Math.cos(u))):f=w,a=c.x+y.nx*m,n=c.y+y.ny*m,a+=-y.ny*f*d,n+=y.nx*f*d,t.arc(a,n,f,l.ang+Math.PI/2*d,y.ang-Math.PI/2*d,x),o=c,c=r;t.closePath()}let l=null;const y=()=>l||(()=>{const t=a.Howler.ctx.createAnalyser(),e=a.Howler.ctx.createDelay();t.fftSize=32;const i=t.frequencyBinCount,s=new Uint8Array(i);return t.connect(e),e.connect(a.Howler.masterGain),t.getByteTimeDomainData(s),l={analyserNode:t,bufferLength:i,dataArray:s,connect:e=>{e.disconnect(),e.connect(t)},disconnect:t=>{t.disconnect()},analyseData:()=>(e.delayTime.setValueAtTime(.3,a.Howler.ctx.currentTime),t.getByteTimeDomainData(s),s),delayNode:e},l})();class p extends s{constructor(){super(...arguments),e(this,"options",{vertical:!0,circle:!0,appendTo:null}),e(this,"props",{active:!1}),e(this,"createLineData",(function(t,e,i,s,a,n,h){const{width:o,height:c}=this,{vertical:r}=this.options,l={alpha:h,sineOffset:t,speed:0,drag:e,elastic:i,points:[]};for(var y=a;y>0;y--){let t,e;n=1-Math.abs(y-.5*(a-0))/(a-2)*2,r?(e=.5*c,t=.5*o+.5*this.circleSize-(y-1)*(this.circleSize/(a-2))):(t=.5*o,e=.5*c-.5*this.circleSize+(y-1)*(this.circleSize/(a-2))),l.points.push({x:t,y:e,targetX:t,targetY:e,wavePower:n,offset:0,direction:1,angle:0+r*Math.PI*.5,velocityX:0,velocityY:0})}if(0!=s){a*=1;for(y=0;y<a;y++){const t=Math.PI*s-y/(a-1)*Math.PI*s*1+.5*Math.PI,e=1-Math.abs(y-.5*(a-1))/(a-1)*2,i=.5*o+Math.cos(t)*this.circleSize*.5,n=.5*c+Math.sin(t)*this.circleSize*.5;l.points.push({x:i,y:n,wavePower:.1*e,targetX:i,targetY:n,direction:s,offset:0,angle:t,velocityX:0,velocityY:0})}}return l})),e(this,"drawLine",(function(t){const e=this.ctx,i=t.points,s=.1*performance.now();for(let h=0;h<t.points.length;h++){const a=this.volume_history[h-1]*t.sineOffset,n=i[h].wavePower;i[h].velocityX+=Math.cos(i[h].angle)*a*this.animationWaveyness*n,i[h].velocityX=i[h].velocityX*t.elastic+(i[h].targetX-i[h].x)*t.drag,i[h].velocityY+=Math.sin(i[h].angle)*a*this.animationWaveyness*n,i[h].velocityY=i[h].velocityY*t.elastic+(i[h].targetY-i[h].y)*t.drag;const o=.5,c=Math.sin(.05*s*i[h].direction*t.sineOffset+h*o+t.sineOffset)*this.idleWave*n;i[h].x+=i[h].velocityX+Math.cos(i[h].angle)*c,i[h].y+=i[h].velocityY+Math.sin(i[h].angle)*c,this.draw_debug_points&&(e.beginPath(),e.arc(i[h].x,i[h].y,5,3,0,2*Math.PI),e.stroke())}e.beginPath();for(let h=1;h<t.points.length-1;h++){const s=i[h],a=i[h+1],n=.5*(s.x+a.x),o=.5*(s.y+a.y);h==t.points.length-2?e.quadraticCurveTo(s.x,s.y,a.x,a.y):e.quadraticCurveTo(s.x,s.y,n,o)}const{overlayProgress:a}=h().state.protocol,n=this.options.circle?o(a,.2,.6):1;e.globalAlpha=t.alpha*n,e.stroke()})),e(this,"handleResize",(t=>{const{width:e,height:i}=t.contentRect;c(this.ctx,e,i),this.width=e,this.height=i,this.setupLines()}))}onSetup(){const{appendTo:t}=this.options;this.ctx=i(1,1),this.canvas=this.ctx.canvas,t.appendChild(this.canvas),this.width=1,this.height=1,this.circleSize=1,this.linewidth=1,this.animationWaveyness=1,this.idleWave=1,this.draw_debug_points=!1,this.presoundvol=0,this.setupLines(),n().observe(t,this.handleResize)}setupLines(){const{width:t,height:e}=this,{circle:i,vertical:s}=this.options;this.circleSize=.9*(s?t:e),this.linewidth=this.circleSize/1e3*2,this.animationWaveyness=Math.max(15,(s?e:t)/1e3*100),this.idleWave=10*(s?e/1e3:t/1e3),this.lines=[];const a=i?1:0;this.lines.push(this.createLineData(1,.06,.85,1*a,40,300,.8)),this.lines.push(this.createLineData(-1,.06,.85,-1*a,36,300,i?.8:.2)),this.lines.push(this.createLineData(-.5,.06,.85,0,20,300,i?.4:.1)),this.lines.push(this.createLineData(-.5,.06,.75,0,16,300,i?.4:.3)),this.volume_history=[];for(var n=0,h=0;h<this.lines.length;h++)n=Math.max(n,this.lines[h].points.length);for(h=0;h<n;h++)this.volume_history.push(0)}whileActive(){performance.now();const t=y().analyseData();var e=0;for(let s=0;s<t.length;s++)e+=t[s];e=e/t.length/128-1,e+=.5*(this.presoundvol-e),this.presoundvol=e,this.volume_history.unshift(e),this.volume_history.pop(),this.ctx.save(),this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="destination-in",this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore(),this.ctx.strokeStyle="#FFFFFF",this.ctx.lineWidth=this.linewidth;for(var i=0;i<this.lines.length;i++)this.drawLine(this.lines[i],t)}onDestroy(){n().unobserve(this.options.appendTo)}}export{p as A,r as a,y as b,c as r};
