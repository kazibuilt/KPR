var e=Object.defineProperty,t=(t,s,o)=>(((t,s,o)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[s]=o})(t,"symbol"!=typeof s?s+"":s,o),o);import s from"./the-frame-submenu-nav.a94090da.js";import{x as o,as as i,f as n,r as a,e as r,a9 as p,am as l,at as d,j as h,H as c,E as u,o as m,l as v,q as w,u as y,m as f}from"./entry.40e762a9.js";import{s as g}from"./scroll-to.c5811ab8.js";import{C as b}from"./index.6c8f1534.js";import{D as x,x as j}from"./dom-component.59802661.js";import{s as k}from"./store.4d67c1b5.js";import{A as _,r as K,a as S}from"./index.80933d50.js";import{r as U}from"./resize-observer.8438de8e.js";import{a as E}from"./index-default.25f36e61.js";import{l as M}from"./lerp.a6fc2763.js";import{g as C}from"./BreadCrumbUtils.85e588d3.js";import"./dot-caption.f385565b.js";import"./dot.36dd12fe.js";import"./hacky-text.bd3e68e0.js";import"./useScrollTrigger.934dab30.js";import"./link-hover.6073cf81.js";import"./gozer-env.ed057cb2.js";import"./create-canvas.f1f3dfa0.js";import"./index.77e4f8bb.js";const D=({options:e,props:t,context:s})=>j` <button class="btnKaiHeader" @pointerenter=${s.handleEnter} @pointerleave=${s.handleLeave}  @pointerdown=${s.handlePointerDown} @pointerup=${s.handlePointerUp}>
    <canvas data-ui="lightCanvas" class="btnKaiHeader__bg"></canvas>
    <span class="btnKaiHeader__prWrap">
      <span class="btnKaiHeader__pr"></span>
    </span>
    <span data-ui="audio" class="btnKaiHeader__audio"></span>
    <span class="btnKaiHeader__text  type-btn">K.A.I mode</span>
  </button>`;class P extends b{constructor(){super(...arguments),t(this,"options",{template:D,outline:!1,fill:!0,corner:"right",onComplete:()=>{},onRelease:()=>{}}),t(this,"props",{active:!1,grow:!1,listenMode:!1,aiMode:()=>k().state.protocol.aiMode,overlayProgress:()=>k().state.protocol.overlayProgress}),t(this,"tweens",{pr:0}),t(this,"handleResize",(e=>{const{width:t,height:s,top:o,left:i,bottom:n,right:a}=e.contentRect,{scale:r}=k().state,{corner:p,outline:l,fill:d}=this.options,{canvas:h,ctx:c}=this,u=l?1:0,m="white",v=t+2*i,w=s+o;K(c,v,w),c.clearRect(0,0,v,w),c.beginPath(),c.fillStyle=m,c.strokeStyle=m,c.lineWidth=u;const y=12*r,f=u/2;let g={x:v-f,y:w-y},b={x:v-y,y:w-f},x={x:f,y:w-f};"left"===p&&(g={x:v-f,y:w-f},b={x:y,y:w-f},x={x:f,y:w-y});S(c,[{x:f,y:f},{x:v-f,y:f},g,b,x],5*r),l&&c.stroke(),d&&c.fill()})),t(this,"handleGrowUpdate",(()=>{k().state.protocol.overlayProgress=this.tweens.pr})),t(this,"handleEnter",(()=>{this.setMask(1)})),t(this,"handleLeave",(()=>{this.props.aiMode||this.setMask(0)})),t(this,"handlePointerDown",(e=>{this.onDown()})),t(this,"handlePointerUp",(e=>{this.onUp()})),t(this,"handleKeyDown",(e=>{"Space"===e.code&&this.onDown(e)})),t(this,"handleKeyUp",(e=>{"Space"===e.code&&this.onUp()}))}async onSetup(){this.setupBgs(),await this.setupAudioLines(),this.addEvents(),this.transitionSound=new o.Howl({src:["audio/FX_TBL_Transition.mp3"],rate:2.2})}setupBgs(){this.canvas=this.ui.lightCanvas,this.ctx=this.canvas.getContext("2d")}async setupAudioLines(){this.audioLines=await(new _).setup({options:{appendTo:this.ui.audio,vertical:!0,circle:!1,audioContext:null},props:{active:()=>this.props.active}})}addEvents(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),U().observe(this.el,this.handleResize)}removeEvents(){window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),U().unobserve(this.el)}onActive(){this.el.style.opacity=1,this.el.style.pointerEvents="auto"}offActive({firstTrigger:e}){this.el.style.opacity=0,this.el.style.pointerEvents="none"}onGrow(){i.killTweensOf(this.tweens),i.to(this.tweens,{pr:1,duration:.8,ease:"power1.out",onStart:()=>{},onUpdate:this.handleGrowUpdate,onComplete:this.options.onComplete}),this.transitionSound.seek(0),this.transitionSound.play()}offGrow({firstTrigger:e}){e||this.props.aiMode||(this.options.onRelease(),this.shrink(),this.transitionSound.pause())}offAiMode(){this.props.grow=!1}shrink(){i.killTweensOf(this.tweens),i.to(this.tweens,{pr:0,duration:.8,ease:"power2.out",onUpdate:this.handleGrowUpdate})}setOverlayProgress(e){this.setMask(e)}setMask(e){this.el.style.setProperty("--pr",`${M(e,0,100)}%`)}onDown(e){null==e||e.preventDefault(),this.props.aiMode||(this.props.grow=!0)}onUp(){this.props.aiMode||(this.props.grow=!1)}onDestroy(){this.removeEvents()}}E(P,[x]);const L={class:"group submenu"},T=n({__name:"the-frame-submenu-protocol",props:{},emits:["click"],async setup(e,{emit:t}){let o,i,n;const b=a(null),{app:x,storyblok:j}=r(),_=p();let K=C(_.path,j.lang);const S=([o,i]=l((()=>d(K,{version:j.version}))),o=await o,i(),o).value.content.body.filter((e=>"protocol-chapter"===e.component)).map((e=>({id:e._uid,name:e.title}))),U=a(-1);h((async()=>{"us-en"===j.lang&&(n=await(new P).setup({options:{appendTo:b.value,corner:"left",outline:!0,fill:!1,onComplete:()=>{k().state.protocol.aiMode=!0}},props:{active:()=>k().state.belowFold}}))})),c((()=>{null==n||n.destroy()})),u((()=>x.activeSection),(e=>{U.value=S.findIndex((e=>e.id===x.activeSection))}));const E=(e,t)=>{g(`#${e.id}`)};return(e,t)=>{const o=s;return m(),v("div",L,[w(o,{items:y(S),activeIndex:y(U),onClick:E},null,8,["items","activeIndex"]),f("div",{class:"btnWrap",ref_key:"refBtnWrap",ref:b},null,512)])}}},[["__scopeId","data-v-15224318"]]);export{T as default};
